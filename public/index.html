<!DOCTYPE html>
<html lang="en">
<head>
     <meta charset="UTF-8">
     <meta name="viewport" content="width=device-width, initial-scale=1.0">
     <meta http-equiv="X-UA-Compatible" content="ie=edge">
     <title>shppp</title>
     <link rel="stylesheet" type="text/css" href="scss/style.scss">
     
          <!--script src="https://cdn.jsdelivr.net/npm/vue"></script>
          <script src="https://unpkg.com/dexie@latest/dist/dexie.js"></script-->
          
</head>
<body>
     <!--img src="https://dl.dropboxusercontent.com/s/1mzslkpuoilup3l/okram%40protonmail.ch_D2018-01-21_T17-42-18.jpg?dl=0" 
          alt="img from DB"-->
     <div id="app" >
          <!--img id="preview"-->


          <div v-show="!userName">using app as unregistered</div>
          <div style="width: 100%; display: flex; justify-content: space-around;">

               <div v-show="userName">using app as {{userName}}</div>
               <button v-show="screen=='settings' && userName"  @click="logout"
                    >logout {{userName}}</button>
               
               <button id="" @click="switchScreen('settings')" v-show="screen=='main'">show settings</button>
          </div>
          <br><br>

          <h1>my shopping history</h1>


          <div id="settings" v-show="screen=='settings' || screen== 'signup'" class="vertical marginAround30">
               <button @click="screen='signup'" v-show="screen=='settings' && !userName" 
                    >create account</button>

               <button @click="screen='settings'" v-show="screen=='signup'"
                    >back</button>
               
               <!-- search users -->
               <div style="display: flex" v-show="userName">
                    <input type="text" v-model="searchText" placeholder="find love of your life">
                    <button @click=requestUsers>search</button>
               </div>
               <div v-if="!userName">you cannot follow anyone without creating account</div>
               <!-- search results -->
               <div v-show="searchResults">
                    <div v-for="user in searchResults" class="center just_around">
                         <h4>{{user.userName}}</h4>
                         <button v-if="isFollowed(user.email)===false" @click="followUser(user.email, user.userName)">follow</button>
                         <br>
                         <p v-if="isFollowed(user.email)===true">you followdee</p>
                    </div>
               </div>
               
               <!-- sign up -->
               <div v-show="screen=='signup'" class="vertical marginAround30">
                    <h2>sign down</h2>
                    <form name="signUpForm" class="vertical">     
                         <input type="text" name="reg-username"  placeholder="username" required>
                         <input type="email" name="reg-useremail" placeholder="your email" required>
                         <input type="password" name="reg-userpassword" placeholder="password" required>
                         <button @click="signUp($event)">sign up</button>
                    </form>
               </div>
               <!-- login-->
               <div class="vertical" v-show="screen!=='main' && screen!='signup' && !userName">
                    <h2>count me in</h2>
                    <input type="email" placeholder="email" v-model="loginemail">
                    <p>your password</p>
                    <input type="password" placeholder="pass" v-model="loginpass">
                    <button @click="login($event)">login</button>
               </div>
               <br><br><br><br>
               <div v-show="followedUsers && followedUsers.length>0" class="vertical">
                    <h4>users you follow</h4>
                    <div v-for="user in followedUsers">{{user.username}}</div>
               </div>
               <br><br>
               <h4 v-show="followedUsers && followedUsers.length==0">you dont follow any users yet</h4>


               <h2>settings</h2>
               <div>
                    <button @click="fetchMyCountries()">&#10549; my countries</button>
                    <button @click="pushMyCountries()">my countries &#10548;</button>
               </div>
               <br>
               <button @click="requestDropboxAccess()">connect my Dropbox</button>
               <br>
               <button @click="switchScreen('main')">close settings</button>
          </div>


          
          <br>

          <div id="mainScreen" v-show="screen==='main'" class="vertical">
                  <div id="locButtons" v-show="screen==='main'">
                              <button v-on:click="openLocationInput('country',$event)">add country</button>
                              <button v-on:click="openLocationInput('city',$event)">add city</button>
                              <button v-on:click="openLocationInput('shop',$event)">add shop</button>
                  </div>
               
                  <div id="locations" v-show="screen==='main'">
               
                       <select   id="CountrySel" v-model="currentCountry" data-forlabel="currentCountry" data-saveas="countries"
                                 v-on:change="updateLocationSelect(0, $event)">
                            <option v-for="country in countries">{{country.name}}</option>
                       </select>
        
                       <select   id="CitySel" v-model="currentCity" data-forlabel="currentCity"  data-saveas="cities"
                                 v-on:change="updateLocationSelect(1, $event)">
                            <option v-for="city in cities">{{city.name}}</option>
                       </select>
        
                       <select   id="ShopSel" v-model="currentShop" data-forlabel="currentShop"  data-saveas="shops"
                                 v-on:change="updateLocationSelect(2, $event)">
                            <option v-for="shop in shops">{{shop.name}}</option>
                       </select>
                           
                  </div>
                  <br><br>
        
                  <div id="locationInput" v-show="locationInputShown" class="vertical">
                           
                       <button id="locationInputHide" v-on:click="locationInputShown=false">hide</button>
                           
                       <label>add {{locationSet}}</label>
                       <input id="addCountryIn" type="text" v-model="newLocation">
                       <button id="confCountryBut"  v-on:click="addNewLocation()">confirm</button>
        
                  </div>
        
                  <div id="" v-show="newProductForm === false">
                       {{currentCountry}} - {{currentCity}} - {{currentShop}}
                  </div>
                  <br>

               <!-- products display -->
               <div v-show="newProductForm === false" id="productList">
                    <div v-for="country in countries" v-if="currentCountry == country.name || currentCountry=='all countries'"
                         class="countryContainer">
                         
                         <div v-for="city in country.cities" v-if="currentCity == city.name || currentCity=='all cities'"
                              class="cityContainer">
                              
                              <div v-for="shop in city.shops" v-if="currentShop==shop.name || currentShop == 'all shops'" 
                                   class="shopContainer vertical">
                                   
                                   <!--div v-for="prod in shop.products">{{prod.name}}</div-->
                                   <!--h5 v-if="shop.products.length==0">nothing to display here</h5-->
                                   
                                   <h3 class="locationBanner" v-if="shop.products.length>0">{{country.name}} - {{city.name}} - {{shop.name}}</h3>
                                   
                                   <div v-for="prod in shop.products" class="product" v-if="shop.products.length>0"
                                             v-on:mousedown="startTimer(prod)"
                                             v-on:mouseup="stopTimer($event, prod)"
                                             ><!-- v-on:click="openProductFormToModify(prod)"  -->
                                             

                                        <div v-if="!prod.owner">#</div>
                                        <!--div class="imgContainer" v-if="prod.imgName || prod.dbxURL"></div-->
                                             <img alt="img" :src="prod.dbxURL" @click="enlargeImage($event)" v-if="prod.imgName || prod.dbxURL">
                                        
                                        <div class="prodDataContainer vertical">
                                             <p>{{prod.type}}</p>
                                             <p>{{prod.name}}</p>
                                             <p v-if="prod.descr">{{prod.descr}}</p>
                                             <p v-if="prod.descrLong">{{prod.descrLong}}</p>
                                             <p v-if="prod.price">{{prod.price}}</p>
                                             <p>rating: {{prod.rating}}</p>
                                        </div>
                                        
                                   </div>
                              </div>
                         </div>
                    </div>
               </div>
               
               <!--div id="products" v-show="newProductForm === false && currentDisplayedProducts.length" class="vertical">
                         <br>
                         <div v-for="prod in currentDisplayedProducts" class="product"
                                   v-on:click="openProductForm(prod)" >

                              <div v-if="!prod.owner">#</div>
                              <div class="imgContainer" v-if="prod.imgName">
                                   <img alt="img not here" >
                              </div>
                              <div class="prodDataContainer vertical">
                                   <p>{{prod.type}}</p>
                                   <p>{{prod.name}}</p>
                                   <p>{{prod.descr}}</p>
                                   <p>{{prod.descrLong}}</p>
                                   <p>{{prod.price}}</p>
                                   <p>rating: {{prod.rating}}</p>
                              </div>
                              
                         </div>
               </div-->
                                   
               <!--h4 v-show="newProductForm === false && currentDisplayedProducts.length==0"
                    >no products to display</h4-->

                  


               <button id="addProductButton" v-show="!newProductForm" v-on:click="openProductForm(true)">add product</button>

               <div id="newProductFormContainer" v-show="newProductForm === true">
                    <form name="newProductForm">
                              <canvas v-show="newProductPreview==true" width="300" height="300"></canvas>
                              <input v-show="!modifyingProduct" type="file" accept="img/*" capture="environment" v-on:change="imageAdded($event)">
                              
                              <p>product type</p>
                              <input type="text" name="productType" v-model="newProductType"  placeholder="e.g. Rice milk">
                              <p>product name</p>
                              <input type="text" name="productName" v-model="newProductName"  placeholder="e.g. Natur Pur Reis milch">
                              <p>product description</p>
                              <input type="text" name="productDescription" v-model="newProductDescription">
                                   <textarea cols="40" rows="4" v-model="newProductDescriptionLong" placeholder="Here you can be verbose"></textarea>
                              <p>product price (EUR)</p>
                              <input type="number" name="productPrice" v-model="newProductPrice">
                              <p>rate product</p>
                              <div id="newProductRatingContainer" class="">
                                   <input type="radio" name="newRating" value="0">bad
                                   <input type="radio" name="newRating" value="1">
                                   <input type="radio" name="newRating" value="2" >
                                   <input type="radio" name="newRating" value="3">
                                   <input type="radio" name="newRating" value="4">great
                              </div>
                              <br>
                              <div class="center just_around">
                                   <button v-on:click="deleteProduct($event)"  v-show="modifyingProduct===true"
                                        >delete item</button>
                                   <button @click="newProductSubmit($event)"  v-show="!modifyingProduct"
                                        >submit</button>
                                   <button v-on:click="applyProductChanges($event)"  v-show="modifyingProduct===true"
                                        >apply changes</button>
                              </div>
                            
                    </form>
                    <button id="closeNewProductForm" v-show="newProductForm===true" v-on:click="openProductForm(false)">cancel</button>
                    </div>
                  
                    
          </div>
          
     <div id="console" v-show="console" class="vertical just_center">{{console}}</div>
          
     <!--div id="templ1">
          <slot></slot> hi? {{msg}} <product></product>
     </div-->

     </div ><!-- end vue app -->
        
     <script src="js/index.js"></script>
     
</body>
</html>